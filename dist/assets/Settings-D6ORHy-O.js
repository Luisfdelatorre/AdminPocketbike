import{r as l,j as e,l as me,H as he}from"./main-CESdpagL.js";import{c as y}from"./createLucideIcon-BSP4zInn.js";import{D as ge}from"./dollar-sign-3p03K1Xc.js";import{C as ue}from"./clock-BDU5ytyu.js";import"./modulepreload-polyfill-B5Qt9EMX.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],L=y("database",pe);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],M=y("image",xe);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],fe=y("pen",ve);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],j=y("save",je);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],Ne=y("zoom-in",ye);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],Se=y("zoom-out",Ce),Le=()=>{var $,B,K,Y,X,Z,H;const[a,k]=l.useState({currency:"COP",timezone:"America/Bogota",contractDefaults:{dailyRate:3e4,contractDays:500,freeDaysLimit:4,initialFee:0,emailDomain:"tumotoya.online"},displayName:"PocketBike",companyLogo:"/pocketbike_60x60.jpg",automaticCutOff:!1,cutOffStrategy:1,gpsService:"megarastreo",gpsConfig:{host:"",port:"",user:"",password:"",token:""},wompiConfig:{publicKey:"",privateKey:"",integritySecret:"",eventsSecret:""}}),[I,C]=l.useState(!1),[m,P]=l.useState({}),[h,F]=l.useState({}),[z,E]=l.useState(!1),[V,O]=l.useState(null),[g,x]=l.useState(1),[u,S]=l.useState({x:0,y:0}),[_,N]=l.useState(!1),[b,R]=l.useState({x:0,y:0}),v=l.useRef(null),w=l.useRef(null),p=(t,s)=>{k(n=>({...n,[t]:s})),C(!1)};l.useEffect(()=>{(async()=>{try{const s=await me();s.success&&k(n=>({...n,...s.data,contractDefaults:{...n.contractDefaults,...s.data.contractDefaults||{}},companyLogo:s.data.logo||n.companyLogo}))}catch(s){console.error("Error fetching settings:",s)}})()},[]),l.useEffect(()=>{z&&v.current&&w.current&&W()},[z,V,g,u]);const W=()=>{const t=v.current,s=t.getContext("2d"),n=w.current;if(!n||!n.complete)return;s.clearRect(0,0,t.width,t.height),s.save(),s.translate(t.width/2+u.x,t.height/2+u.y),s.drawImage(n,-n.width*g/2,-n.height*g/2,n.width*g,n.height*g),s.restore();const i=t.width/2,c=t.height/2,d=Math.min(t.width,t.height)*.8,r=d/2;s.fillStyle="rgba(0, 0, 0, 0.6)",s.fillRect(0,0,t.width,t.height),s.clearRect(i-r,c-r,d,d),s.save(),s.beginPath(),s.rect(i-r,c-r,d,d),s.clip(),s.translate(t.width/2+u.x,t.height/2+u.y),s.drawImage(n,-n.width*g/2,-n.height*g/2,n.width*g,n.height*g),s.restore(),s.strokeStyle="#3b82f6",s.lineWidth=3,s.strokeRect(i-r,c-r,d,d)},G=t=>{N(!0),R({x:t.clientX-u.x,y:t.clientY-u.y})},J=t=>{_&&S({x:t.clientX-b.x,y:t.clientY-b.y})},U=()=>{N(!1)},q=t=>{const s=t.touches[0];N(!0),R({x:s.clientX-u.x,y:s.clientY-u.y})},Q=t=>{if(!_)return;t.preventDefault();const s=t.touches[0];S({x:s.clientX-b.x,y:s.clientY-b.y})},ee=()=>{N(!1)},te=async()=>{await f("all")},f=async t=>{P(s=>({...s,[t]:!0}));try{const s=localStorage.getItem("token")||localStorage.getItem("auth_token");let n={};t==="all"?n={...a,logo:a.companyLogo}:t==="branding"?n={displayName:a.displayName,logo:a.companyLogo}:t==="gps"?n={gpsService:a.gpsService,gpsConfig:a.gpsConfig}:t==="wompi"?n={wompiConfig:a.wompiConfig}:t==="cutoff"?n={automaticCutOff:a.automaticCutOff,cutOffStrategy:a.cutOffStrategy}:t==="general"&&(n={currency:a.currency,timezone:a.timezone,contractDefaults:a.contractDefaults});const i=await he(n);i.success?(console.log(`${t} settings saved successfully`),F(c=>({...c,[t]:!0})),setTimeout(()=>{F(c=>({...c,[t]:!1}))},3e3),(t==="all"||t==="branding")&&(localStorage.setItem("companyLogo",a.companyLogo),localStorage.setItem("displayName",a.displayName)),t==="all"&&(C(!0),setTimeout(()=>C(!1),3e3))):alert(`Error saving ${t} settings: `+i.error)}catch(s){console.error(`Error saving ${t} settings:`,s),alert(`Error saving ${t} settings`)}finally{P(s=>({...s,[t]:!1}))}},se=t=>{const s=t.target.files[0];if(s){if(!s.type.startsWith("image/")){alert("Please upload an image file");return}if(s.size>2*1024*1024){alert("Image size should be less than 2MB");return}const n=new FileReader;n.onloadend=()=>{const i=new Image;i.onload=()=>{if(w.current=i,v.current){const c=v.current,d=c.width/i.width,r=c.height/i.height,D=Math.max(d,r)*.8;x(D),S({x:0,y:0})}O(n.result),E(!0)},i.src=n.result},n.readAsDataURL(s),t.target.value=""}},ae=()=>{const t=v.current,s=w.current;if(!t||!s)return;const n=document.createElement("canvas");n.width=300,n.height=300;const i=n.getContext("2d"),c=t.width/2,d=t.height/2,r=Math.min(t.width,t.height)*.8,D=r/2,ce=c-D,re=d-D;i.drawImage(t,ce+2,re+2,r-4,r-4,0,0,300,300);const de=n.toDataURL("image/png");p("companyLogo",de),A()},A=()=>{E(!1),O(null),x(1),S({x:0,y:0}),N(!1)},ne=t=>{x(parseFloat(t.target.value))},ie=()=>{x(t=>Math.min(t+.05,3))},oe=()=>{x(t=>Math.max(t-.1,.5))},le=t=>{const s=t.deltaY>0?-.1:.1;x(n=>Math.min(Math.max(n+s,.5),3))},T=t=>`$${t.toLocaleString()} COP`,o=(t,s,n)=>{k(i=>({...i,[t]:{...i[t],[s]:n}})),C(!1)};return e.jsxs("div",{className:"settings-page",children:[e.jsx("div",{className:"page-header",children:e.jsxs("div",{children:[e.jsx("h1",{children:"⚙️ Settings"}),e.jsx("p",{children:"Configure your application preferences"})]})}),e.jsxs("div",{className:"settings-container",children:[e.jsxs("div",{className:"settings-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx(M,{size:20}),e.jsx("h2",{children:"Company Branding"}),e.jsx("button",{className:`btn-save-section ${h.branding?"btn-saved":""}`,onClick:()=>f("branding"),disabled:m.branding,children:m.branding?"Saving...":h.branding?"Saved":e.jsx(j,{size:16})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsxs("label",{htmlFor:"displayName",children:[e.jsx(M,{size:16}),"Company Display Name"]}),e.jsx("input",{id:"displayName",type:"text",value:a.displayName,onChange:t=>p("displayName",t.target.value),placeholder:"PocketBike",className:"input-display-name"}),e.jsx("p",{className:"setting-description",children:"This name will be displayed on the payment page."})]}),e.jsxs("div",{className:"setting-item",children:[e.jsxs("label",{htmlFor:"companyLogo",children:[e.jsx(M,{size:16}),"Company Logo"]}),e.jsxs("div",{className:"branding-upload-area",children:[e.jsxs("div",{className:"current-logo-container",children:[e.jsx("img",{src:a.companyLogo,alt:"Company Logo",onError:t=>{t.target.src="/pocketbike_60x60.jpg"}}),e.jsx("button",{type:"button",className:"btn-edit-logo",onClick:()=>document.getElementById("companyLogo").click(),title:"Change Logo",children:e.jsx(fe,{size:14})})]}),e.jsx("div",{className:"upload-dropzone",onClick:()=>document.getElementById("companyLogo").click(),children:e.jsx("span",{className:"upload-text",children:"Upload New Logo"})}),e.jsx("input",{id:"companyLogo",type:"file",accept:"image/*",onChange:se,style:{display:"none"}})]}),e.jsx("p",{className:"upload-hint-text",children:"RECOMMENDED: 60X60PX, PNG OR JPG, MAX 2MB"})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx(L,{size:20}),e.jsx("h2",{children:"General Settings"}),e.jsx("button",{className:`btn-save-section ${h.general?"btn-saved":""}`,onClick:()=>f("general"),disabled:m.general,children:m.general?"Saving...":h.general?"Saved":e.jsx(j,{size:16})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"emailDomain",children:"Default Email Domain"}),e.jsxs("div",{className:"input-group",children:[e.jsx("span",{className:"input-prefix",children:"@"}),e.jsx("input",{id:"emailDomain",type:"text",value:(($=a.contractDefaults)==null?void 0:$.emailDomain)||"tumotoya.online",onChange:t=>o("contractDefaults","emailDomain",t.target.value),placeholder:"tumotoya.online"})]}),e.jsx("p",{className:"setting-description",children:"Domain used for auto-generated customer emails"})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"dailyRate",children:"Default Daily Rate (COP)"}),e.jsxs("div",{className:"input-group",children:[e.jsx("input",{id:"dailyRate",type:"number",value:((B=a.contractDefaults)==null?void 0:B.dailyRate)||3e4,onChange:t=>o("contractDefaults","dailyRate",parseInt(t.target.value)),placeholder:"30000"}),e.jsx("span",{className:"input-hint",children:T(((K=a.contractDefaults)==null?void 0:K.dailyRate)||3e4)})]}),e.jsx("p",{className:"setting-description",children:"Base rate per day in cents"})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"contractDays",children:"Default Contract Days"}),e.jsx("input",{id:"contractDays",type:"number",value:((Y=a.contractDefaults)==null?void 0:Y.contractDays)||500,onChange:t=>o("contractDefaults","contractDays",parseInt(t.target.value)),placeholder:"500"}),e.jsx("p",{className:"setting-description",children:"Default duration for new contracts"})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"freeDaysLimit",children:"Default Free Days Limit"}),e.jsx("input",{id:"freeDaysLimit",type:"number",value:((X=a.contractDefaults)==null?void 0:X.freeDaysLimit)||4,onChange:t=>o("contractDefaults","freeDaysLimit",parseInt(t.target.value)),placeholder:"4"}),e.jsx("p",{className:"setting-description",children:"Default monthly free days for new contracts"})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"initialFee",children:"Default Initial Fee"}),e.jsxs("div",{className:"input-group",children:[e.jsx("input",{id:"initialFee",type:"number",value:((Z=a.contractDefaults)==null?void 0:Z.initialFee)||0,onChange:t=>o("contractDefaults","initialFee",parseInt(t.target.value)),placeholder:"0"}),e.jsx("span",{className:"input-hint",children:T(((H=a.contractDefaults)==null?void 0:H.initialFee)||0)})]}),e.jsx("p",{className:"setting-description",children:"Default initial fee for new contracts"})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"currency",children:"Currency"}),e.jsxs("select",{id:"currency",value:a.currency,onChange:t=>p("currency",t.target.value),children:[e.jsx("option",{value:"COP",children:"COP (Colombian Peso)"}),e.jsx("option",{value:"USD",children:"USD (US Dollar)"}),e.jsx("option",{value:"EUR",children:"EUR (Euro)"})]}),e.jsx("p",{className:"setting-description",children:"Display currency for amounts"})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"timezone",children:"Timezone"}),e.jsxs("select",{id:"timezone",value:a.timezone,onChange:t=>p("timezone",t.target.value),children:[e.jsx("option",{value:"America/Bogota",children:"America/Bogota (UTC-5)"}),e.jsx("option",{value:"America/New_York",children:"America/New_York (UTC-5)"}),e.jsx("option",{value:"America/Los_Angeles",children:"America/Los_Angeles (UTC-8)"}),e.jsx("option",{value:"Europe/London",children:"Europe/London (UTC+0)"})]}),e.jsx("p",{className:"setting-description",children:"Timezone for dates and times"})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx(L,{size:20}),e.jsx("h2",{children:"GPS Service Integration"}),e.jsx("button",{className:`btn-save-section ${h.gps?"btn-saved":""}`,onClick:()=>f("gps"),disabled:m.gps,children:m.gps?"Saving...":h.gps?"Saved":e.jsx(j,{size:16})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"gpsService",children:"Select Provider"}),e.jsxs("select",{id:"gpsService",value:a.gpsService,onChange:t=>p("gpsService",t.target.value),children:[e.jsx("option",{value:"megarastreo",children:"MegaRastreo"}),e.jsx("option",{value:"traccar",children:"Traccar (Not implemented yet)"})]})]}),a.gpsService==="megarastreo"&&e.jsxs("div",{className:"integration-fields",children:[e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"mrUser",children:"MegaRastreo Username"}),e.jsx("input",{id:"mrUser",type:"text",value:a.gpsConfig.user,onChange:t=>o("gpsConfig","user",t.target.value),placeholder:"Enter username"})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"mrPass",children:"MegaRastreo Password"}),e.jsx("input",{id:"mrPass",type:"password",value:a.gpsConfig.password,onChange:t=>o("gpsConfig","password",t.target.value),placeholder:"Enter password"})]})]}),a.gpsService==="traccar"&&e.jsxs("div",{className:"integration-fields",children:[e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"trHost",children:"Traccar Host"}),e.jsx("input",{id:"trHost",type:"text",value:a.gpsConfig.host,onChange:t=>o("gpsConfig","host",t.target.value),placeholder:"e.g. 198.74.54.252"})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"trUser",children:"Username"}),e.jsx("input",{id:"trUser",type:"text",value:a.gpsConfig.user,onChange:t=>o("gpsConfig","user",t.target.value)})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"trPass",children:"Password"}),e.jsx("input",{id:"trPass",type:"password",value:a.gpsConfig.password,onChange:t=>o("gpsConfig","password",t.target.value)})]})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx(ge,{size:20}),e.jsx("h2",{children:"Wompi Payments Configuration"}),e.jsx("button",{className:`btn-save-section ${h.wompi?"btn-saved":""}`,onClick:()=>f("wompi"),disabled:m.wompi,children:m.wompi?"Saving...":h.wompi?"Saved":e.jsx(j,{size:16})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"wPubKey",children:"Public Key"}),e.jsx("input",{id:"wPubKey",type:"text",value:a.wompiConfig.publicKey,onChange:t=>o("wompiConfig","publicKey",t.target.value),placeholder:"pub_test_..."})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"wPrivKey",children:"Private Key"}),e.jsx("input",{id:"wPrivKey",type:"password",value:a.wompiConfig.privateKey,onChange:t=>o("wompiConfig","privateKey",t.target.value),placeholder:"prv_test_..."})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"wInteg",children:"Integrity Secret"}),e.jsx("input",{id:"wInteg",type:"password",value:a.wompiConfig.integritySecret,onChange:t=>o("wompiConfig","integritySecret",t.target.value),placeholder:"test_integrity_..."})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"wEvents",children:"Events Secret"}),e.jsx("input",{id:"wEvents",type:"password",value:a.wompiConfig.eventsSecret,onChange:t=>o("wompiConfig","eventsSecret",t.target.value),placeholder:"test_events_..."})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx(ue,{size:20}),e.jsx("h2",{children:"Automatic Cut-Off Control"}),e.jsx("button",{className:`btn-save-section ${h.cutoff?"btn-saved":""}`,onClick:()=>f("cutoff"),disabled:m.cutoff,children:m.cutoff?"Saving...":h.cutoff?"Saved":e.jsx(j,{size:16})})]}),e.jsxs("div",{className:"setting-item toggle-item",children:[e.jsxs("div",{className:"setting-info",children:[e.jsx("label",{htmlFor:"automaticCutOff",children:"Enable Automatic Engine Stop"}),e.jsx("p",{className:"setting-description",children:"Automatically turn off engines at 11:59 PM for devices with unpaid invoices."})]}),e.jsx("input",{id:"automaticCutOff",type:"checkbox",checked:a.automaticCutOff,onChange:t=>p("automaticCutOff",t.target.checked),className:"toggle-checkbox"})]}),a.automaticCutOff&&e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"cutOffStrategy",children:"Cut-Off Strategy"}),e.jsxs("select",{id:"cutOffStrategy",value:a.cutOffStrategy,onChange:t=>p("cutOffStrategy",parseInt(t.target.value)),className:"strategy-select",children:[e.jsx("option",{value:1,children:"1. Invoice de hoy no está pago"}),e.jsx("option",{value:2,children:"2. Invoice de ayer no está pago"}),e.jsx("option",{value:3,children:"3. No apagar / Dejar libre"})]}),e.jsx("p",{className:"setting-description",children:"Choose which payment condition triggers the automatic cutoff."})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx(L,{size:20}),e.jsx("h2",{children:"System Information"})]}),e.jsxs("div",{className:"info-grid",children:[e.jsxs("div",{className:"info-item",children:[e.jsx("div",{className:"info-label",children:"Application Version"}),e.jsx("div",{className:"info-value",children:"1.0.0"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("div",{className:"info-label",children:"Database Status"}),e.jsx("div",{className:"info-value status-connected",children:"Connected"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("div",{className:"info-label",children:"API Status"}),e.jsx("div",{className:"info-value status-connected",children:"Active"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("div",{className:"info-label",children:"Last Backup"}),e.jsx("div",{className:"info-value",children:"Never"})]})]})]})]}),e.jsx("div",{className:"settings-actions",children:e.jsxs("button",{className:`btn-save ${I?"btn-saved":""}`,onClick:te,children:[e.jsx(j,{}),I?"All Settings Saved!":"Save All Settings"]})}),z&&e.jsx("div",{className:"crop-modal-overlay",children:e.jsxs("div",{className:"crop-modal-content",children:[e.jsx("h3",{className:"crop-modal-title",children:"Crop Your Logo"}),e.jsx("div",{className:"crop-canvas-container",children:e.jsx("canvas",{ref:v,width:600,height:600,className:"crop-canvas",onMouseDown:G,onMouseMove:J,onMouseUp:U,onMouseLeave:U,onTouchStart:q,onTouchMove:Q,onTouchEnd:ee,onWheel:le})}),e.jsxs("div",{className:"crop-controls",children:[e.jsxs("div",{className:"zoom-controls",children:[e.jsx("button",{className:"btn-zoom",onClick:oe,title:"Zoom Out",children:e.jsx(Se,{size:20})}),e.jsx("input",{type:"range",min:"0.5",max:"3",step:"0.01",value:g,onChange:ne,className:"zoom-slider"}),e.jsx("button",{className:"btn-zoom",onClick:ie,title:"Zoom In",children:e.jsx(Ne,{size:20})})]}),e.jsx("p",{className:"crop-hint",children:"Drag to reposition • Use slider to zoom"})]}),e.jsxs("div",{className:"crop-actions",children:[e.jsx("button",{className:"btn-cancel",onClick:A,children:"Cancel"}),e.jsx("button",{className:"btn-crop",onClick:ae,children:"Crop & Save"})]})]})})]})};export{Le as default};
