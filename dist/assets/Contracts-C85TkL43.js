import{r as c,p as $,q as R,j as e,t as M,v as O,w as q}from"./index-DYjkxkRa.js";import{P as z,S as B}from"./square-pen-CQ7z1fAC.js";import{F as E}from"./file-text-Cejw2rtJ.js";import{T as V}from"./trending-up-nD40-y8e.js";import{C as f}from"./check-CfhuOiZV.js";import{D as U}from"./dollar-sign-4mQ7fe36.js";import{S as Q}from"./search-DneDA0BG.js";import{X as S}from"./x-D1T7jfee.js";import{C as H}from"./calendar-CZKMEmBV.js";import"./createLucideIcon-b_PnP7i0.js";const ae=()=>{const[m,I]=c.useState([]),[w,A]=c.useState([]),[p,u]=c.useState(!0),[o,h]=c.useState("all"),[x,g]=c.useState(""),[k,i]=c.useState(!1),[n,y]=c.useState(null),[a,l]=c.useState({deviceId:"",customerName:"",customerEmail:"",customerPhone:"",customerDocument:"",dailyRate:3e6,contractDays:500,startDate:new Date().toISOString().split("T")[0],notes:""});c.useEffect(()=>{C(),P()},[o]);const C=async()=>{u(!0);try{const s=await $();s.success?I(s.contracts||[]):console.error("Failed to fetch contracts:",s.error)}catch(s){console.error("Error loading contracts:",s)}finally{u(!1)}},P=async()=>{try{const s=await R();s.success&&A(s.devices||[])}catch(s){console.error("Error loading devices:",s)}},L=()=>{y(null),l({deviceId:"",customerName:"",customerEmail:"",customerPhone:"",customerDocument:"",dailyRate:3e6,contractDays:500,startDate:new Date().toISOString().split("T")[0],notes:""}),i(!0)},T=s=>{y(s),l({deviceId:s.deviceId,customerName:s.customerName||"",customerEmail:s.customerEmail||"",customerPhone:s.customerPhone||"",customerDocument:s.customerDocument||"",dailyRate:s.dailyRate,contractDays:s.contractDays,startDate:s.startDate,notes:s.notes||""}),i(!0)},F=async s=>{s.preventDefault(),u(!0);try{const t=n?await O(n.contractId,a):await q(a);t.success?(i(!1),C(),alert(n?"Contract updated successfully!":"Contract created successfully!")):alert(`Error: ${t.error}`)}catch(t){console.error("Error saving contract:",t),alert("Failed to save contract")}finally{u(!1)}},b=async(s,t)=>{if(confirm(`Are you sure you want to change the status to ${t}?`))try{const r=await M(s,t);r.success?(C(),alert("Status updated successfully!")):alert(`Error: ${r.error}`)}catch(r){console.error("Error updating status:",r),alert("Failed to update status")}},j=s=>`$${(s/100).toLocaleString()} COP`,N=s=>({ACTIVE:"#00C292",COMPLETED:"#03C9D7",CANCELLED:"#EF4444",SUSPENDED:"#FB9678"})[s]||"#6B7280",D=m.filter(s=>{var t,r;if(o!=="all"&&s.status.toLowerCase()!==o.toLowerCase())return!1;if(x){const d=x.toLowerCase();return s.deviceId.toLowerCase().includes(d)||s.contractId.toLowerCase().includes(d)||((t=s.customerName)==null?void 0:t.toLowerCase().includes(d))||((r=s.customerEmail)==null?void 0:r.toLowerCase().includes(d))}return!0}),v=({title:s,value:t,icon:r,color:d})=>e.jsxs("div",{className:"contract-stat-card",children:[e.jsx("div",{className:"stat-icon",style:{background:d},children:e.jsx(r,{size:20})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("div",{className:"stat-label",children:s}),e.jsx("div",{className:"stat-number",children:t})]})]});return e.jsxs("div",{className:"contracts-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsxs("div",{children:[e.jsx("h1",{children:"ðŸ“‹ Contracts Management"}),e.jsx("p",{children:"Manage 500-day rental contracts for all devices"})]}),e.jsxs("button",{className:"btn-primary",onClick:L,children:[e.jsx(z,{})," New Contract"]})]}),e.jsxs("div",{className:"contracts-stats",children:[e.jsx(v,{title:"Total Contracts",value:m.length,icon:E,color:"#03C9D7"}),e.jsx(v,{title:"Active",value:m.filter(s=>s.status==="ACTIVE").length,icon:V,color:"#00C292"}),e.jsx(v,{title:"Completed",value:m.filter(s=>s.status==="COMPLETED").length,icon:f,color:"#7460EE"}),e.jsx(v,{title:"Total Value",value:j(m.reduce((s,t)=>s+t.totalAmount,0)),icon:U,color:"#FB9678"})]}),e.jsx("div",{className:"contracts-search",children:e.jsxs("div",{className:"search-box",children:[e.jsx(Q,{className:"search-icon"}),e.jsx("input",{type:"text",placeholder:"Search by device ID, contract ID, customer name or email...",value:x,onChange:s=>g(s.target.value)}),x&&e.jsx("button",{className:"clear-search",onClick:()=>g(""),"aria-label":"Clear search",children:e.jsx(S,{})})]})}),e.jsxs("div",{className:"contracts-filters",children:[e.jsx("button",{className:`filter-btn ${o==="all"?"active":""}`,onClick:()=>h("all"),children:"All Contracts"}),e.jsx("button",{className:`filter-btn ${o==="active"?"active":""}`,onClick:()=>h("active"),children:"Active"}),e.jsx("button",{className:`filter-btn ${o==="completed"?"active":""}`,onClick:()=>h("completed"),children:"Completed"}),e.jsx("button",{className:`filter-btn ${o==="cancelled"?"active":""}`,onClick:()=>h("cancelled"),children:"Cancelled"})]}),e.jsx("div",{className:"contracts-list",children:p?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading contracts..."})]}):D.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(E,{size:48}),e.jsx("h3",{children:"No contracts found"}),e.jsx("p",{children:"Create a new contract to get started"})]}):D.map(s=>e.jsxs("div",{className:"contract-card",children:[e.jsxs("div",{className:"contract-header",children:[e.jsxs("div",{className:"contract-title",children:[e.jsx("h3",{children:s.deviceId}),e.jsx("span",{className:"status-badge",style:{background:`${N(s.status)}20`,color:N(s.status)},children:s.status})]}),e.jsx("div",{className:"contract-id",children:e.jsx("small",{children:s.contractId})})]}),e.jsxs("div",{className:"contract-body",children:[e.jsxs("div",{className:"contract-info-grid",children:[e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"info-label",children:"Customer"}),e.jsx("span",{className:"info-value",children:s.customerName||"N/A"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"info-label",children:"Daily Rate"}),e.jsx("span",{className:"info-value",children:j(s.dailyRate)})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"info-label",children:"Total Days"}),e.jsxs("span",{className:"info-value",children:[s.contractDays," days"]})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"info-label",children:"Total Amount"}),e.jsx("span",{className:"info-value",children:j(s.totalAmount)})]})]}),e.jsxs("div",{className:"contract-progress",children:[e.jsxs("div",{className:"progress-header",children:[e.jsxs("span",{children:["Progress: ",s.paidDays," / ",s.contractDays," days"]}),e.jsxs("span",{className:"progress-percent",children:[(s.paidDays/s.contractDays*100).toFixed(1),"%"]})]}),e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill",style:{width:`${s.paidDays/s.contractDays*100}%`,background:N(s.status)}})}),e.jsxs("div",{className:"progress-details",children:[e.jsxs("div",{children:[e.jsx(f,{size:14}),"Paid: ",j(s.paidAmount)]}),e.jsxs("div",{children:[e.jsx(H,{size:14}),s.startDate," â†’ ",s.endDate]})]})]})]}),e.jsxs("div",{className:"contract-actions",children:[e.jsxs("button",{className:"btn-text btn-complete",onClick:()=>T(s),children:[e.jsx(B,{})," Edit"]}),s.status==="ACTIVE"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"btn-text btn-complete",onClick:()=>b(s.contractId,"COMPLETED"),children:[e.jsx(f,{})," Mark Complete"]}),e.jsxs("button",{className:"btn-text btn-cancel",onClick:()=>b(s.contractId,"CANCELLED"),children:[e.jsx(S,{})," Cancel"]})]})]})]},s.contractId))}),k&&e.jsx("div",{className:"modal-overlay",onClick:()=>i(!1),children:e.jsxs("div",{className:"modal-content",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:n?"Edit Contract":"New Contract"}),e.jsx("button",{className:"modal-close",onClick:()=>i(!1),children:"Ã—"})]}),e.jsxs("form",{onSubmit:F,className:"contract-form",children:[e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Device ID *"}),n?e.jsx("input",{type:"text",value:a.deviceId,disabled:!0}):e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:a.deviceId,onChange:s=>l({...a,deviceId:s.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"Select a device..."}),w.map(s=>e.jsxs("option",{value:s.deviceId,disabled:s.hasActiveContract,children:[s.deviceId," ",s.hasActiveContract?"(Has Active Contract)":"(Available)"]},s.deviceId))]}),e.jsx("small",{style:{color:"#6B7280",fontSize:"0.813rem",marginTop:"0.25rem",display:"block"},children:"Each device can only have one active contract. Cancel existing contracts before creating a new one."})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Start Date *"}),e.jsx("input",{type:"date",value:a.startDate,onChange:s=>l({...a,startDate:s.target.value}),required:!0,disabled:n})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Customer Name"}),e.jsx("input",{type:"text",value:a.customerName,onChange:s=>l({...a,customerName:s.target.value}),placeholder:"John Doe"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Customer Email"}),e.jsx("input",{type:"email",value:a.customerEmail,onChange:s=>l({...a,customerEmail:s.target.value}),placeholder:"customer@email.com"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Customer Phone"}),e.jsx("input",{type:"tel",value:a.customerPhone,onChange:s=>l({...a,customerPhone:s.target.value}),placeholder:"+57 300 123 4567"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Customer Document"}),e.jsx("input",{type:"text",value:a.customerDocument,onChange:s=>l({...a,customerDocument:s.target.value}),placeholder:"ID/CC Number"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Daily Rate (COP)"}),e.jsx("input",{type:"number",value:a.dailyRate/100,onChange:s=>l({...a,dailyRate:parseInt(s.target.value)*100}),min:"0",step:"1000",placeholder:"30000"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Contract Days"}),e.jsx("input",{type:"number",value:a.contractDays,onChange:s=>l({...a,contractDays:parseInt(s.target.value)}),min:"1",max:"1000",disabled:n})]})]}),e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{children:"Notes"}),e.jsx("textarea",{value:a.notes,onChange:s=>l({...a,notes:s.target.value}),rows:"3",placeholder:"Additional notes..."})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>i(!1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-primary",disabled:p,children:p?"Saving...":n?"Update Contract":"Create Contract"})]})]})]})})]})};export{ae as default};
