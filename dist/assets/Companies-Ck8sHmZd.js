import{r as l,j as e,w as T,d as L,A as P,B as F,C as q}from"./main-CfsT50y0.js";import{u as z}from"./useTranslation-Dr7ilz_7.js";import{S as D}from"./search-CPdBVXh6.js";import{C as O}from"./check-C4eg8Me1.js";import{P as $}from"./Users-Dlm17aJ-.js";import{B}from"./building-B3_xhnOM.js";import{P as R}from"./plus-BRaefUQd.js";import{c as H}from"./createLucideIcon-BVLfzT-S.js";import{X as U}from"./x-B5cEk_pk.js";import"./modulepreload-polyfill-B5Qt9EMX.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],X=H("link",V),G=({isOpen:g,onClose:N,company:c,allDevices:m,onSave:y})=>{const{t:C}=z(),[x,u]=l.useState(""),[o,h]=l.useState(new Set);if(l.useEffect(()=>{if(g&&c&&m){const a=m.filter(t=>t.companyId===c._id).map(t=>t._id);h(new Set(a)),u("")}},[g,c,m]),!g||!c)return null;const b=a=>{const t=new Set(o);t.has(a)?t.delete(a):t.add(a),h(t)},S=a=>{const t=new Set(o);a.every(i=>t.has(i._id))?a.forEach(i=>t.delete(i._id)):a.forEach(i=>t.add(i._id)),h(t)},v=()=>{y(c._id,Array.from(o))},p=m.filter(a=>a.name.toLowerCase().includes(x.toLowerCase())||a.simCardNumber&&a.simCardNumber.includes(x)||a.nequiNumber&&a.nequiNumber.includes(x)),d=o.size,f=m.length;return e.jsx("div",{className:"modal-overlay",onClick:N,children:e.jsxs("div",{className:"modal-content large",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{children:[e.jsxs("h2",{children:["Manage Devices - ",c.name]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Assign devices to this company"})]}),e.jsx("button",{className:"modal-close",onClick:N,children:"Ã—"})]}),e.jsxs("div",{className:"p-4 border-b border-gray-100 bg-gray-50",children:[e.jsxs("div",{className:"search-box mb-4",children:[e.jsx(D,{className:"search-icon",size:18}),e.jsx("input",{type:"text",placeholder:"Search devices by name, SIM, or phone...",value:x,onChange:a=>u(a.target.value),className:"w-full"})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("span",{className:"font-medium text-indigo-600",children:[d," Selected"]}),e.jsxs("span",{className:"text-gray-500",children:[f," Total"]})]}),e.jsx("button",{type:"button",className:"text-indigo-600 hover:text-indigo-800 font-medium",onClick:()=>S(p),children:p.every(a=>o.has(a._id))?"Deselect All":"Select All Visible"})]})]}),e.jsx("div",{className:"overflow-y-auto",style:{maxHeight:"60vh"},children:p.length>0?e.jsx("div",{className:"divide-y divide-gray-100",children:p.map(a=>{const t=o.has(a._id),n=a.companyId&&a.companyId!==c._id;return e.jsxs("label",{className:`flex items-center p-3 hover:bg-gray-50 cursor-pointer transition-colors ${t?"bg-indigo-50/50":""}`,children:[e.jsx("div",{className:"relative flex items-center justify-center p-1",children:e.jsx("input",{type:"checkbox",className:"w-5 h-5 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500",checked:t,onChange:()=>b(a._id)})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:`font-medium ${t?"text-indigo-900":"text-gray-900"}`,children:a.name}),n&&e.jsx("span",{className:"text-xs text-orange-600 bg-orange-50 px-2 py-0.5 rounded-full",children:a.companyName||"Other Company"}),a.companyId===c._id&&e.jsxs("span",{className:"text-xs text-green-600 bg-green-50 px-2 py-0.5 rounded-full flex items-center gap-1",children:[e.jsx(O,{size:10})," Current"]})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5 flex gap-3",children:[e.jsxs("span",{children:["SIM: ",a.simCardNumber||"-"]}),e.jsxs("span",{children:["Phone: ",a.nequiNumber||"-"]})]})]})]},a._id)})}):e.jsx("div",{className:"p-8 text-center text-gray-500",children:"No devices found matching your search."})}),e.jsxs("div",{className:"modal-actions p-4 border-t border-gray-100 bg-white sticky bottom-0",children:[e.jsx("button",{className:"btn-secondary",onClick:N,children:"Cancel"}),e.jsxs("button",{className:"btn-primary",onClick:v,children:["Save Changes (",d,")"]})]})]})})},ne=()=>{const[g,N]=l.useState([]),[c,m]=l.useState([]),[y,C]=l.useState(!0),[x,u]=l.useState(!1),[o,h]=l.useState(!1),[b,S]=l.useState(null),[v,p]=l.useState(""),[d,f]=l.useState(!1),[a,t]=l.useState(null),[n,i]=l.useState({name:"",nit:"",phone:"",email:"",address:""});l.useEffect(()=>{w()},[]);const w=async()=>{C(!0);try{const[s,r]=await Promise.all([T(),L()]);if(s.success&&N(s.data),r.success){const j=r.devices||r.data||[];m(j)}}catch(s){console.error("Error loading data:",s),alert("Error loading data")}finally{C(!1)}},k=()=>{i({name:"",nit:"",phone:"",email:"",address:""}),f(!1),t(null),u(!1)},_=s=>{i({name:s.name,nit:s.nit||"",phone:s.phone||"",email:s.email||"",address:s.address||""}),f(!0),t(s._id),u(!0)},A=async s=>{s.preventDefault();try{let r;d?r=await P(a,n):r=await F(n),r.success?(alert(`Company ${d?"updated":"created"} successfully`),k(),w()):alert(r.error||`Failed to ${d?"update":"create"} company`)}catch(r){console.error(r),alert(`Error ${d?"updating":"creating"} company`)}},M=s=>{S(s),h(!0)},I=async(s,r)=>{try{const j=await q(s,r);j.success?(alert("Devices assigned successfully"),h(!1),w()):alert(j.error||"Failed to assign devices")}catch(j){console.error(j),alert("Error assigning devices")}},E=g.filter(s=>s.name.toLowerCase().includes(v.toLowerCase())||s.nit&&s.nit.includes(v));return e.jsxs("div",{className:"users-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsxs("div",{children:[e.jsxs("h1",{children:[e.jsx(B,{className:"inline-icon"})," Companies Management"]}),e.jsx("p",{children:"Manage system companies"})]}),e.jsx("div",{className:"header-actions",children:e.jsxs("button",{className:"btn-primary",onClick:()=>u(!0),children:[e.jsx(R,{size:16})," Add Company"]})})]}),e.jsx("div",{className:"users-search",children:e.jsxs("div",{className:"search-box",children:[e.jsx(D,{className:"search-icon"}),e.jsx("input",{type:"text",placeholder:"Search companies...",value:v,onChange:s=>p(s.target.value)})]})}),e.jsx("div",{className:"users-list",children:y?e.jsx("div",{className:"loading-state",children:"Loading..."}):e.jsxs("table",{className:"data-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"NIT"}),e.jsx("th",{children:"Phone"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[E.map(s=>e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("div",{className:"user-name",children:s.name}),e.jsx("small",{children:s.address})]}),e.jsx("td",{children:s.nit||"-"}),e.jsx("td",{children:s.phone||"-"}),e.jsx("td",{children:s.email||"-"}),e.jsx("td",{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn-icon",onClick:()=>M(s),title:"Manage Devices",children:e.jsx(X,{size:16})}),e.jsx("button",{className:"btn-icon",onClick:()=>_(s),title:"Edit Company",children:e.jsx($,{size:16})})]})})]},s._id)),E.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"text-center",children:"No companies found"})})]})]})}),x&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:d?"Edit Company":"Add New Company"}),e.jsx("button",{className:"modal-close",onClick:k,children:e.jsx(U,{})})]}),e.jsxs("form",{onSubmit:A,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Company Name"}),e.jsx("input",{type:"text",required:!0,value:n.name,onChange:s=>i({...n,name:s.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"NIT (Optional)"}),e.jsx("input",{type:"text",value:n.nit,onChange:s=>i({...n,nit:s.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Phone (Optional)"}),e.jsx("input",{type:"text",value:n.phone,onChange:s=>i({...n,phone:s.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email (Optional)"}),e.jsx("input",{type:"email",value:n.email,onChange:s=>i({...n,email:s.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Address (Optional)"}),e.jsx("input",{type:"text",value:n.address,onChange:s=>i({...n,address:s.target.value})})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:k,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-primary",children:d?"Update Company":"Create Company"})]})]})]})}),e.jsx(G,{isOpen:o,onClose:()=>h(!1),company:b,allDevices:c,onSave:I})]})};export{ne as default};
