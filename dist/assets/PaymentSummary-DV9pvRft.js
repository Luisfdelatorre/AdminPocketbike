import{u as S,r,j as e,P}from"./main-CESdpagL.js";import{R as A,M as C}from"./MotorIcon-Cw4aOK89.js";import"./modulepreload-polyfill-B5Qt9EMX.js";import"./createLucideIcon-BSP4zInn.js";const m=n=>n?n>=1e3?`$${(n/1e3).toFixed(0)}k`:`$${n}`:"-",R=()=>{S();const[n,u]=r.useState(!1),[c,v]=r.useState([]),d=r.useRef(null),j=new Date,[o,g]=r.useState(j.getMonth()+1),[h,y]=r.useState(j.getFullYear()),x=new Date(h,o,0).getDate(),N=c.length>0?Math.max(...c.map(s=>{const t=Object.keys(s.days).map(Number);return t.length>0?Math.max(...t):0})):x,b=Math.min(Math.max(N,1),x),p=Array.from({length:b},(s,t)=>t+1),f=async()=>{u(!0);try{const s=await P({month:o,year:h});s.success&&Array.isArray(s.data)&&v(s.data)}catch(s){console.error("Error fetching summary:",s)}finally{u(!1)}};return r.useEffect(()=>{f()},[o,h]),r.useEffect(()=>{!n&&c.length>0&&d.current&&(d.current.scrollLeft=d.current.scrollWidth)},[n,c]),e.jsxs("div",{className:"payment-summary-container",children:[e.jsxs("div",{className:"summary-header",children:[e.jsx("h1",{children:"Estatus de Pagos"}),e.jsxs("div",{className:"controls",children:[e.jsx("select",{value:o,onChange:s=>g(parseInt(s.target.value)),className:"select-control",children:Array.from({length:12},(s,t)=>e.jsx("option",{value:t+1,children:new Date(0,t).toLocaleString("es-ES",{month:"long"})},t+1))}),e.jsxs("select",{value:h,onChange:s=>y(parseInt(s.target.value)),className:"select-control",children:[e.jsx("option",{value:2025,children:"2025"}),e.jsx("option",{value:2026,children:"2026"}),e.jsx("option",{value:2027,children:"2027"})]}),e.jsx("button",{className:`select-control refresh-btn ${n?"spinning":""}`,onClick:f,disabled:n,title:"Actualizar datos",children:e.jsx(A,{size:20})})]})]}),e.jsx("div",{className:"matrix-container",ref:d,children:e.jsxs("table",{className:"summary-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"DISPOSITIVO"}),e.jsx("th",{children:"Deuda"}),p.map(s=>e.jsx("th",{children:String(s).padStart(2,"0")},s)),e.jsx("th",{children:"--"},"day1")]})}),e.jsx("tbody",{children:n?e.jsx("tr",{children:e.jsx("td",{colSpan:x+1,children:"Cargando..."})}):c.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"device-cell",children:[e.jsx("span",{className:"device-name",children:s.device.name}),e.jsx("span",{className:"driver-name",children:s.device.driverName||"Sin Conductor"})]})}),e.jsx("td",{children:e.jsx("div",{className:"device-cell",children:s.device.unpaidTotal>0?e.jsx("span",{className:"debt-badge",children:m(s.device.unpaidTotal)}):e.jsx("span",{className:"no-debt",children:"✓"})})}),p.map(t=>{const a=s.days[t];let i="status-cell empty",l="--";return l=m(a==null?void 0:a.totalPaid),a&&(console.log(a),a.dayType==="LOAN"?(i="status-cell loand",l="--"):a.dayType==="PAID"?(i="status-cell approved",l=(a==null?void 0:a.totalPaid)>0?m(a==null?void 0:a.totalPaid):"✓"):a.dayType==="FREE"?(i="status-cell free",l=(a==null?void 0:a.totalPaid)>0?m(a==null?void 0:a.totalPaid):"✓"):i="status-cell pending",a.cutOff&&(l=e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx("span",{children:l}),e.jsx("div",{style:{position:"absolute",top:"-8px",right:"-18px"},children:e.jsx(C,{color:"#ef4444",size:14})})]}))),e.jsx("td",{children:e.jsx("div",{className:i,children:l})},t)})]},s.device.deviceId))})]})}),e.jsxs("div",{className:"legend",children:[e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"indicator",style:{background:"#22c55e"}}),e.jsx("span",{children:"Pagado"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"indicator",style:{background:"#ef4444"}}),e.jsx("span",{children:"Corte / Apagado"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"indicator",style:{background:"#f59e0b"}}),e.jsx("span",{children:"Pase Provisional"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"indicator",style:{background:"#fca5a5"}}),e.jsx("span",{children:"Pendiente / Alerta"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"indicator",style:{background:"#f1f5f9"}}),e.jsx("span",{children:"Sin registro"})]})]})]})};export{R as default};
