import{r as o,l as O,m as R,j as e,n as q,o as B,p as V}from"./main-C1Sfkfil.js";import{s as d}from"./toast-DASUAV0i.js";import{P as G}from"./plus-C2GEUUmZ.js";import{F as S}from"./file-text-DNTuAW6a.js";import{T as U}from"./trending-up-Dj9terqE.js";import{C as b}from"./check-DZRCZ4fl.js";import{D as _}from"./dollar-sign-DRxWpRMY.js";import{S as Q,X as k}from"./x-7SGPei2i.js";import{c as J}from"./createLucideIcon-_2uQCNRD.js";import{S as W}from"./square-pen-Db5GOgbH.js";import{C as X}from"./calendar-CImsKiXo.js";import"./modulepreload-polyfill-B5Qt9EMX.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],K=J("ellipsis-vertical",H),de=()=>{const[u,L]=o.useState([]),[w,T]=o.useState([]),[C,v]=o.useState(!0),[c,p]=o.useState("all"),[j,D]=o.useState(""),[A,m]=o.useState(!1),[i,E]=o.useState(null),[h,x]=o.useState(null),[a,r]=o.useState({deviceId:"",customerName:"",customerEmail:"",customerPhone:"",customerDocument:"",dailyRate:3e4,contractDays:500,startDate:new Date().toISOString().split("T")[0],notes:"",devicePin:"",freeDaysLimit:4});o.useEffect(()=>{N(),z();const s=t=>{h&&!t.target.closest(".action-menu-container")&&x(null)};return document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[c,h]);const N=async()=>{v(!0);try{const s=await O();s.success?L(s.contracts||[]):console.error("Failed to fetch contracts:",s.error)}catch(s){console.error("Error loading contracts:",s)}finally{v(!1)}},z=async()=>{try{const s=await R();s.success&&T(s.devices||[])}catch(s){console.error("Error loading devices:",s)}},F=()=>{E(null),r({deviceId:"",customerName:"",customerEmail:"",customerPhone:"",customerDocument:"",dailyRate:3e4,contractDays:500,startDate:new Date().toISOString().split("T")[0],notes:"",devicePin:Math.floor(1e3+Math.random()*9e3).toString(),freeDaysLimit:4}),m(!0)},$=s=>{E(s),r({deviceId:s.deviceId,customerName:s.customerName||"",customerEmail:s.customerEmail||"",customerPhone:s.customerPhone||"",customerDocument:s.customerDocument||"",dailyRate:s.dailyRate,contractDays:s.contractDays,startDate:s.startDate,notes:s.notes||"",devicePin:"",freeDaysLimit:s.freeDaysLimit||4}),m(!0)},M=async s=>{s.preventDefault(),v(!0);try{const t=i?await B(i.contractId,a):await V(a);t.success?(m(!1),N(),d(i?"Â¡Contrato actualizado exitosamente!":"Â¡Contrato creado exitosamente!","success")):d(`Error: ${t.error}`,"error")}catch(t){console.error("Error saving contract:",t),d("Error al guardar contrato","error")}finally{v(!1)}},I=async(s,t)=>{if(confirm(`Â¿EstÃ¡ seguro de cambiar el estado a ${t}?`))try{const l=await q(s,t);l.success?(N(),d("Â¡Estado actualizado exitosamente!","success")):d(`Error: ${l.error}`,"error")}catch(l){console.error("Error updating status:",l),d("Error al actualizar estado","error")}},g=s=>`$${s.toLocaleString()} COP`,y=s=>({ACTIVE:"#00C292",COMPLETED:"#03C9D7",CANCELLED:"#EF4444",SUSPENDED:"#FB9678"})[s]||"#6B7280",P=u.filter(s=>{var t,l;if(c!=="all"&&s.status.toLowerCase()!==c.toLowerCase())return!1;if(j){const n=j.toLowerCase();return s.deviceId.toLowerCase().includes(n)||s.contractId.toLowerCase().includes(n)||((t=s.customerName)==null?void 0:t.toLowerCase().includes(n))||((l=s.customerEmail)==null?void 0:l.toLowerCase().includes(n))}return!0}),f=({title:s,value:t,icon:l,color:n})=>e.jsxs("div",{className:"contract-stat-card",children:[e.jsx("div",{className:"stat-icon",style:{background:n},children:e.jsx(l,{size:20})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("div",{className:"stat-label",children:s}),e.jsx("div",{className:"stat-number",children:t})]})]});return e.jsxs("div",{className:"contracts-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsxs("div",{children:[e.jsx("h1",{children:"ðŸ“‹ GestiÃ³n de Contratos"}),e.jsx("p",{children:"Gestionar contratos de alquiler de 500 dÃ­as para todos los dispositivos"})]}),e.jsxs("button",{className:"btn-primary",onClick:F,children:[e.jsx(G,{})," Nuevo Contrato"]})]}),e.jsxs("div",{className:"contracts-stats",children:[e.jsx(f,{title:"Total Contratos",value:u.length,icon:S,color:"#03C9D7"}),e.jsx(f,{title:"Activos",value:u.filter(s=>s.status==="ACTIVE").length,icon:U,color:"#00C292"}),e.jsx(f,{title:"Completados",value:u.filter(s=>s.status==="COMPLETED").length,icon:b,color:"#7460EE"}),e.jsx(f,{title:"Valor Total",value:g(u.reduce((s,t)=>s+t.totalAmount,0)),icon:_,color:"#FB9678"})]}),e.jsxs("div",{className:"contracts-filters",children:[e.jsx("button",{className:`filter-btn ${c==="all"?"active":""}`,onClick:()=>p("all"),children:"Todos"}),e.jsx("button",{className:`filter-btn ${c==="active"?"active":""}`,onClick:()=>p("active"),children:"Activos"}),e.jsx("button",{className:`filter-btn ${c==="completed"?"active":""}`,onClick:()=>p("completed"),children:"Completados"}),e.jsx("button",{className:`filter-btn ${c==="cancelled"?"active":""}`,onClick:()=>p("cancelled"),children:"Cancelados"}),e.jsxs("div",{className:"search-box",children:[e.jsx(Q,{className:"search-icon"}),e.jsx("input",{type:"text",placeholder:"Buscar por ID, nombre o email...",value:j,onChange:s=>D(s.target.value)}),j&&e.jsx("button",{className:"clear-search",onClick:()=>D(""),"aria-label":"Clear search",children:e.jsx(k,{})})]})]}),e.jsx("div",{className:"contracts-list",children:C?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Cargando contratos..."})]}):P.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(S,{size:48}),e.jsx("h3",{children:"No se encontraron contratos"}),e.jsx("p",{children:"Cree un nuevo contrato para comenzar"})]}):P.map(s=>e.jsx("div",{className:"contract-card",children:e.jsxs("div",{className:"contract-body",children:[e.jsxs("div",{className:"contract-info-grid",children:[e.jsxs("div",{className:"contract-title",children:[e.jsx("h3",{children:e.jsx("a",{href:`/p/${s.deviceIdName||s.deviceId}`,target:"_blank",rel:"noopener noreferrer",className:"text-gray-900 hover:text-indigo-600 transition-colors",title:"Open Payment Page",children:s.deviceIdName||s.deviceId})}),e.jsx("span",{className:"status-badge",style:{background:`${y(s.status)}20`,color:y(s.status)},children:s.status})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"info-label",children:"Cliente"}),e.jsx("span",{className:"info-value",children:s.customerName||"N/A"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"info-label",children:"Tarifa Diaria"}),e.jsx("span",{className:"info-value",children:g(s.dailyRate)})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"info-label",children:"DÃ­as Totales"}),e.jsxs("span",{className:"info-value",children:[s.contractDays," dÃ­as"]})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"info-label",children:"Monto Total"}),e.jsx("span",{className:"info-value",children:g(s.totalAmount)})]}),e.jsx("div",{className:"info-item action-menu-wrapper",children:e.jsxs("div",{className:"action-menu-container",children:[e.jsx("button",{className:`action-menu-btn ${h===s.contractId?"active":""}`,onClick:t=>{t.stopPropagation(),x(h===s.contractId?null:s.contractId)},children:e.jsx(K,{size:20})}),h===s.contractId&&e.jsxs("div",{className:"action-menu-dropdown",children:[e.jsxs("button",{onClick:()=>{$(s),x(null)},children:[e.jsx(W,{size:16})," Editar"]}),s.status==="ACTIVE"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{I(s.contractId,"COMPLETED"),x(null)},children:[e.jsx(b,{size:16})," Completar"]}),e.jsxs("button",{className:"text-danger",onClick:()=>{I(s.contractId,"CANCELLED"),x(null)},children:[e.jsx(k,{size:16})," Cancelar"]})]})]})]})})]}),e.jsxs("div",{className:"contract-progress",children:[e.jsxs("div",{className:"progress-header",children:[e.jsxs("span",{children:["Progreso: ",s.paidDays," / ",s.contractDays," dÃ­as"]}),e.jsxs("span",{className:"progress-percent",children:[(s.paidDays/s.contractDays*100).toFixed(1),"%"]})]}),e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill",style:{width:`${s.paidDays/s.contractDays*100}%`,background:y(s.status)}})}),e.jsxs("div",{className:"progress-details",children:[e.jsxs("div",{children:[e.jsx(b,{size:14}),"Pagado: ",g(s.paidAmount)]}),e.jsxs("div",{children:[e.jsx(X,{size:14}),s.startDate," â†’ ",s.endDate]})]})]})]})},s.contractId))}),A&&e.jsx("div",{className:"modal-overlay",onClick:()=>m(!1),children:e.jsxs("div",{className:"modal-content",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:i?"Editar Contrato":"Nuevo Contrato"}),e.jsx("button",{className:"modal-close",onClick:()=>m(!1),children:"Ã—"})]}),e.jsxs("form",{onSubmit:M,className:"contract-form",children:[e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"ID Dispositivo *"}),i?e.jsx("input",{type:"text",value:a.deviceId,disabled:!0}):e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:a.deviceId,onChange:s=>r({...a,deviceId:s.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"Seleccionar dispositivo..."}),w.filter(s=>!s.hasActiveContract).map(s=>e.jsx("option",{value:s.deviceId,children:s.name||""},s.deviceId))]}),e.jsx("small",{style:{color:"#6B7280",fontSize:"0.813rem",marginTop:"0.25rem",display:"block"},children:"Cada dispositivo solo puede tener un contrato activo. Cancele los contratos existentes antes de crear uno nuevo."})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Fecha Inicio *"}),e.jsx("input",{type:"date",value:a.startDate,onChange:s=>r({...a,startDate:s.target.value}),required:!0,disabled:i})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["PIN del Dispositivo ",i?"(Dejar vacÃ­o para mantener el actual)":"*"]}),e.jsx("input",{type:"text",value:a.devicePin,onChange:s=>r({...a,devicePin:s.target.value}),placeholder:"PIN de 4 dÃ­gitos",maxLength:"4",className:"font-mono",required:!i}),e.jsxs("div",{style:{marginTop:"0.5rem",display:"flex",alignItems:"center"},children:[e.jsx("input",{type:"checkbox",id:"usePhonePin",style:{marginRight:"0.5rem",width:"auto"},onChange:s=>{if(s.target.checked){const l=(a.customerPhone||"").replace(/\D/g,"");l.length>=4?r(n=>({...n,devicePin:l.slice(-4)})):(d("Ingrese un nÃºmero de celular vÃ¡lido primero","error"),s.target.checked=!1)}}}),e.jsx("label",{htmlFor:"usePhonePin",style:{fontSize:"0.9rem",color:"#4B5563",cursor:"pointer"},children:"Usa los Ãºltimos 4 del celular"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Nombre del Cliente"}),e.jsx("input",{type:"text",value:a.customerName,onChange:s=>r({...a,customerName:s.target.value}),placeholder:"John Doe"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email del Cliente"}),e.jsx("input",{type:"email",value:a.customerEmail,onChange:s=>r({...a,customerEmail:s.target.value}),placeholder:"cliente@email.com"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"TelÃ©fono del Cliente"}),e.jsx("input",{type:"tel",value:a.customerPhone,onChange:s=>r({...a,customerPhone:s.target.value}),placeholder:"300 000 0000"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Documento del Cliente"}),e.jsx("input",{type:"text",value:a.customerDocument,onChange:s=>r({...a,customerDocument:s.target.value}),placeholder:"CÃ©dula/NIT"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Tarifa Diaria (COP)"}),e.jsx("input",{type:"number",value:a.dailyRate,onChange:s=>r({...a,dailyRate:parseInt(s.target.value)}),min:"0",step:"1000",placeholder:"30000"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"DÃ­as de Contrato"}),e.jsx("input",{type:"number",value:a.contractDays,onChange:s=>r({...a,contractDays:parseInt(s.target.value)}),min:"1",max:"1000"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"DÃ­as Libres al Mes"}),e.jsx("input",{type:"number",value:a.freeDaysLimit,onChange:s=>r({...a,freeDaysLimit:parseInt(s.target.value)}),min:"0",max:"31"})]})]}),e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{children:"Notas"}),e.jsx("textarea",{value:a.notes,onChange:s=>r({...a,notes:s.target.value}),rows:"3",placeholder:"Notas adicionales..."})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>m(!1),children:"Cancelar"}),e.jsx("button",{type:"submit",className:"btn-primary",disabled:C,children:C?"Guardando...":i?"Actualizar Contrato":"Crear Contrato"})]})]})]})})]})};export{de as default};
