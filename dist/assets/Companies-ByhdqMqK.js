import{r as l,j as e,y as T,d as L,C as P,D as z,E as F}from"./main-DVAXFARq.js";import{u as q}from"./useTranslation-LM3aqFs0.js";import{S as E,X as O}from"./x-BNAztCrf.js";import{C as $}from"./check-Ddl6_53K.js";import{P as R}from"./Users-Cpfv2oPn.js";import{B}from"./building-Bpb4H7C4.js";import{P as H}from"./plus-CLAC8xEl.js";import{c as U}from"./createLucideIcon-Cp5FBxft.js";import"./modulepreload-polyfill-B5Qt9EMX.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],X=U("link",V),G=({isOpen:j,onClose:v,company:c,allDevices:m,onSave:y})=>{const{t:b}=q(),[x,u]=l.useState(""),[d,h]=l.useState(new Set);if(l.useEffect(()=>{if(j&&c&&m){const a=m.filter(t=>t.companyId===c._id).map(t=>t._id);h(new Set(a)),u("")}},[j,c,m]),!j||!c)return null;const C=a=>{const t=new Set(d);t.has(a)?t.delete(a):t.add(a),h(t)},S=a=>{const t=new Set(d);a.every(i=>t.has(i._id))?a.forEach(i=>t.delete(i._id)):a.forEach(i=>t.add(i._id)),h(t)},f=()=>{y(c._id,Array.from(d))},p=m.filter(a=>a.name.toLowerCase().includes(x.toLowerCase())||a.simCardNumber&&a.simCardNumber.includes(x)||a.nequiNumber&&a.nequiNumber.includes(x)),o=d.size,N=m.length;return e.jsx("div",{className:"modal-overlay",onClick:v,children:e.jsxs("div",{className:"modal-content large",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{children:[e.jsxs("h2",{children:["Manage Devices - ",c.name]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Assign devices to this company"})]}),e.jsx("button",{className:"modal-close",onClick:v,children:"Ã—"})]}),e.jsxs("div",{className:"p-4 border-b border-gray-100 bg-gray-50",children:[e.jsxs("div",{className:"search-box mb-4",children:[e.jsx(E,{className:"search-icon",size:18}),e.jsx("input",{type:"text",placeholder:"Search devices by name, SIM, or phone...",value:x,onChange:a=>u(a.target.value),className:"w-full"})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("span",{className:"font-medium text-indigo-600",children:[o," Selected"]}),e.jsxs("span",{className:"text-gray-500",children:[N," Total"]})]}),e.jsx("button",{type:"button",className:"text-indigo-600 hover:text-indigo-800 font-medium",onClick:()=>S(p),children:p.every(a=>d.has(a._id))?"Deselect All":"Select All Visible"})]})]}),e.jsx("div",{className:"overflow-y-auto",style:{maxHeight:"60vh"},children:p.length>0?e.jsx("div",{className:"divide-y divide-gray-100",children:p.map(a=>{const t=d.has(a._id),n=a.companyId&&a.companyId!==c._id;return e.jsxs("label",{className:`flex items-center p-3 hover:bg-gray-50 cursor-pointer transition-colors ${t?"bg-indigo-50/50":""}`,children:[e.jsx("div",{className:"relative flex items-center justify-center p-1",children:e.jsx("input",{type:"checkbox",className:"w-5 h-5 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500",checked:t,onChange:()=>C(a._id)})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:`font-medium ${t?"text-indigo-900":"text-gray-900"}`,children:a.name}),n&&e.jsx("span",{className:"text-xs text-orange-600 bg-orange-50 px-2 py-0.5 rounded-full",children:a.companyName||"Other Company"}),a.companyId===c._id&&e.jsxs("span",{className:"text-xs text-green-600 bg-green-50 px-2 py-0.5 rounded-full flex items-center gap-1",children:[e.jsx($,{size:10})," Current"]})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5 flex gap-3",children:[e.jsxs("span",{children:["SIM: ",a.simCardNumber||"-"]}),e.jsxs("span",{children:["Phone: ",a.nequiNumber||"-"]})]})]})]},a._id)})}):e.jsx("div",{className:"p-8 text-center text-gray-500",children:"No devices found matching your search."})}),e.jsxs("div",{className:"modal-actions p-4 border-t border-gray-100 bg-white sticky bottom-0",children:[e.jsx("button",{className:"btn-secondary",onClick:v,children:"Cancel"}),e.jsxs("button",{className:"btn-primary",onClick:f,children:["Save Changes (",o,")"]})]})]})})},te=()=>{const[j,v]=l.useState([]),[c,m]=l.useState([]),[y,b]=l.useState(!0),[x,u]=l.useState(!1),[d,h]=l.useState(!1),[C,S]=l.useState(null),[f,p]=l.useState(""),[o,N]=l.useState(!1),[a,t]=l.useState(null),[n,i]=l.useState({name:"",nit:"",phone:"",email:"",address:"",automaticInvoicing:!1});l.useEffect(()=>{w()},[]);const w=async()=>{b(!0);try{const[s,r]=await Promise.all([T(),L()]);if(s.success&&v(s.data),r.success){const g=r.devices||r.data||[];m(g)}}catch(s){console.error("Error loading data:",s),alert("Error loading data")}finally{b(!1)}},k=()=>{i({name:"",nit:"",phone:"",email:"",address:"",automaticInvoicing:!1}),N(!1),t(null),u(!1)},D=s=>{i({name:s.name,nit:s.nit||"",phone:s.phone||"",email:s.email||"",address:s.address||"",automaticInvoicing:s.automaticInvoicing||!1}),N(!0),t(s._id),u(!0)},_=async s=>{s.preventDefault();try{let r;o?r=await P(a,n):r=await z(n),r.success?(alert(`Company ${o?"updated":"created"} successfully`),k(),w()):alert(r.error||`Failed to ${o?"update":"create"} company`)}catch(r){console.error(r),alert(`Error ${o?"updating":"creating"} company`)}},A=s=>{S(s),h(!0)},M=async(s,r)=>{try{const g=await F(s,r);g.success?(alert("Devices assigned successfully"),h(!1),w()):alert(g.error||"Failed to assign devices")}catch(g){console.error(g),alert("Error assigning devices")}},I=j.filter(s=>s.name.toLowerCase().includes(f.toLowerCase())||s.nit&&s.nit.includes(f));return e.jsxs("div",{className:"users-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsxs("div",{children:[e.jsxs("h1",{children:[e.jsx(B,{className:"inline-icon"})," Companies Management"]}),e.jsx("p",{children:"Manage system companies"})]}),e.jsx("div",{className:"header-actions",children:e.jsxs("button",{className:"btn-primary",onClick:()=>u(!0),children:[e.jsx(H,{size:16})," Add Company"]})})]}),e.jsx("div",{className:"users-search",children:e.jsxs("div",{className:"search-box",children:[e.jsx(E,{className:"search-icon"}),e.jsx("input",{type:"text",placeholder:"Search companies...",value:f,onChange:s=>p(s.target.value)})]})}),e.jsx("div",{className:"users-list",children:y?e.jsx("div",{className:"loading-state",children:"Loading..."}):e.jsxs("table",{className:"data-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"NIT"}),e.jsx("th",{children:"Phone"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[I.map(s=>e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsxs("div",{className:"user-name",children:[s.name,s.automaticInvoicing&&e.jsx("span",{className:"badge badge-success",style:{fontSize:"0.7rem",padding:"2px 6px",borderRadius:"4px",background:"#e6fffa",color:"#00C292",marginLeft:"8px",border:"1px solid #00C292"},children:"Auto-Invoice"})]}),e.jsx("small",{children:s.address})]}),e.jsx("td",{children:s.nit||"-"}),e.jsx("td",{children:s.phone||"-"}),e.jsx("td",{children:s.email||"-"}),e.jsx("td",{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn-icon",onClick:()=>A(s),title:"Manage Devices",children:e.jsx(X,{size:16})}),e.jsx("button",{className:"btn-icon",onClick:()=>D(s),title:"Edit Company",children:e.jsx(R,{size:16})})]})})]},s._id)),I.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"text-center",children:"No companies found"})})]})]})}),x&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:o?"Edit Company":"Add New Company"}),e.jsx("button",{className:"modal-close",onClick:k,children:e.jsx(O,{})})]}),e.jsxs("form",{onSubmit:_,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Company Name"}),e.jsx("input",{type:"text",required:!0,value:n.name,onChange:s=>i({...n,name:s.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"NIT (Optional)"}),e.jsx("input",{type:"text",value:n.nit,onChange:s=>i({...n,nit:s.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Phone (Optional)"}),e.jsx("input",{type:"text",value:n.phone,onChange:s=>i({...n,phone:s.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email (Optional)"}),e.jsx("input",{type:"email",value:n.email,onChange:s=>i({...n,email:s.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Address (Optional)"}),e.jsx("input",{type:"text",value:n.address,onChange:s=>i({...n,address:s.target.value})})]}),e.jsx("div",{className:"form-group checkbox-group",children:e.jsxs("label",{className:"flex items-center gap-2",style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:n.automaticInvoicing,onChange:s=>i({...n,automaticInvoicing:s.target.checked}),style:{width:"auto",margin:0}}),e.jsx("span",{children:"Enable Automatic Daily Invoicing"})]})}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:k,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-primary",children:o?"Update Company":"Create Company"})]})]})]})}),e.jsx(G,{isOpen:d,onClose:()=>h(!1),company:C,allDevices:c,onSave:M})]})};export{te as default};
